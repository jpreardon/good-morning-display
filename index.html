<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Good Morning Display II</title>
        <meta name="viewport" content="width=device-width, intial-scale=1">

        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"> 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://momentjs.com/downloads/moment.js"></script>
        <style>
            body {
                font-family: 'Roboto', sans-serif;
                margin: 0;
                padding: 0;
                background-color: #000000;
                color: #ffffff;
            }

            #container {
                width: 100%;
                height: 100vh;
                overflow: auto;
            }

            .big-number {
                font-weight: 100;
                font-size: 72px;
                line-height: 72px;
                margin: 0;
            }

            .big-label {
                font-weight: 100;
                font-size: 16px;
                line-height: 16px;
                max-width: 155px;
                margin: 0;
            }

            #current-conditions {
                margin-top: 4%;
                margin-left: 4%;
                float: left;
            }

            #temperature {
                border: 2px solid #ffffff;
                height: 192px;
                width: 192px;
                border-radius: 50%;
                display: flex;
                align-items: center;
            }

            #wind {
                border: 2px solid #ffffff;
                height: 192px;
                width: 192px;
                border-radius: 50%;
                margin-top: 12.2%;
                display: flex;
                align-items: center;
                position: relative;
                z-index: auto;
            }

            #wind-arrow {
                height: 100%;
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;
                z-index: -1;
            }

            #forecast {
                padding-left: 4%;
                margin-top: 4%;
                margin-left: 28.5%;
                padding-right: 4%;
            }

            p.error {
                color: #6f6f6f;
            }

            #forecast p.error {
                padding-top: 40%;
                text-align: center;
            }

            #update-time {
                margin-left: 2%;
                margin-top: 14%;
                width: 40px;
                height: 15px;
                text-align: left;
                clear: both;
            }

            #update-time p {
                color: #6f6f6f;
                font-weight: 100;
                font-size: 12px;
            }

            #forecast h2 {
                font-weight: 100;
                font-size: 24px;
                margin-bottom: 16px;
                margin-top: 32px;
            }

            #forecast h2:first-child {
                margin-top: 0;
            }

            #forecast p {
                font-weight: 100;
                font-size: 16px;
                margin: 0;
            }

            .inner {
                margin: auto;
                text-align: center;
            }

            .hide {
                display: none;
            }

        </style>
        <script>
            function cToF(celsius) {
                if (celsius == null) {
                    return null
                } else {
                    celsius = celsius * 9 /5 + 32
                    return celsius.toFixed(0) + "º"
                }
            }

            function mpsToMph(metersPerSecond) {
                if (metersPerSecond == null) {
                    return null
                } else {
                    milesPerHour = metersPerSecond * 2.236936
                    return milesPerHour.toFixed(1)
                }
            }

            function replaceNulls(value, replacement = "--") {
                if (value == null) {
                    return replacement
                } else {
                    return value
                } 
            }

            function updateWeather() {
                const current_condition_url = "https://api.weather.gov/stations/KNYC/observations/latest"
                const forecast_url = "https://api.weather.gov/gridpoints/OKX/34,33/forecast"

                $.getJSON( current_condition_url ) 
                    .done(function( json ) {
                        $("#temperature > div.inner > p.big-number").html(replaceNulls(cToF(json.properties.temperature.value)))
                        $("#temperature > div.inner > p.big-label").html(replaceNulls(json.properties.textDescription, ""))
                        $("#wind > div.inner > p.big-number").html(replaceNulls(mpsToMph(json.properties.windSpeed.value)))
                        if (json.properties.windDirection.value == null) {
                            $("#wind-arrow").addClass("hide")
                        } else {
                            $("#wind-arrow").css("transform", "rotate(" + json.properties.windDirection.value + "deg)").removeClass("hide")
                        }
                    })
                    .fail(function ( jqxhr, textStatus, error ) {
                        $("#temperature > .inner").html('<p class="error">Current conditions not available ¯\\_(ツ)_/¯</p>')
                        $("#wind > .inner").html('<p class="error">Current conditions not available ¯\\_(ツ)_/¯</p>')
                        console.log("[Current Conditions] " + textStatus + ": " + error)
                })

                $.getJSON( forecast_url )
                    .done(function( json ) {
                        $("#forecast > #f1-title").html(json.properties.periods[0].name)
                        $("#forecast > #f1").html(json.properties.periods[0].detailedForecast)
                        $("#forecast > #f2-title").html(json.properties.periods[1].name)
                        $("#forecast > #f2").html(json.properties.periods[1].detailedForecast)
                        $("#forecast > #f3-title").html(json.properties.periods[2].name)
                        $("#forecast > #f3").html(json.properties.periods[2].shortForecast)
                    })
                    .fail(function ( jqxhr, textStatus, error ) {
                        $("#forecast").html('<p class="error">Forecast not available ¯\\_(ツ)_/¯</p>')
                        console.log("[Forecast] " + textStatus + ": " + error)
                })
                
                $("#update-time > p").html(moment().format("HH:mm"))
            }

            $( document ).ready(function() {
                updateWeather()
                window.setInterval(updateWeather, 60 * 30 * 1000)
            })
        </script>
    </head>
    <body>
        <div id="container">
            <div id="current-conditions">
                <div id="temperature">
                    <div class="inner">
                        <p class="big-number"></p>
                        <p class="big-label"></p>
                    </div>
                </div>
                <div id="wind">
                    <div class="inner">
                        <div id="wind-arrow" class="hide">
                            <img src="wind-arrow.png" />
                        </div>
                        <p class="big-number"></p>
                        <p class="big-label">MPH</p>
                    </div>
                </div>
            </div>
            <div id="forecast">
                <h2 id="f1-title"></h2>
                <p id="f1"></p>

                <h2 id="f2-title"></h2>
                <p id="f2"></p>

                <h2 id="f3-title"></h2>
                <p id="f3"></p>
            </div>
            <div id="update-time">
                <p></p>
            </div>
        </div>
    </body>
</html>