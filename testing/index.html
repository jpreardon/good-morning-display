<html>
    <head>
        <title>MTA Test</title>
        <script type="text/javascript" src="protobuf.js"></script>
        <script>
            //const path = require('path')
            //const fetch = require('node-fetch')
            const ProtoBuf = protobuf
            var feedme

            //const API_KEY = require('./api-key')
            const API_KEY = " "

            const API_URL = 'https://api-endpoint.mta.info/Dataservice/mtagtfsfeeds/nyct%2F'

            /* const FEED_IDS = [
                'gtfs-ace',
                'gtfs-bdfm',
                'gtfs-g',
                'gtfs-jz',
                'gtfs-nqrw',
                'gtfs-l',
                'gtfs',
                'gtfs-7',
                'gtfs-si'
            ] */

            const FEED_IDS = [
                'gtfs-bdfm'
            ]

            const protoBufDef = "nyct-subway.proto.txt"
            ProtoBuf.load(protoBufDef, (error, root) => {
                if (error) throw error
                const FeedMessage = root.lookupType('transit_realtime.FeedMessage')
                for (const feedID of FEED_IDS) {
                    const url = `${API_URL}${feedID}`
                    fetch(url, { headers: { 'x-api-key': API_KEY } })
                    .then(res => res.arrayBuffer())
                    .then(body => {
                        //const buf = Buffer.from(body)
                        const buf = new Uint8Array(body)
                        const feed = FeedMessage.decode(buf)
                        feedme = feed
                        for (const message of feed.entity) {
                            console.log(message)
                        }
                    })
                }
            })

            
            
        </script>
    </head>
    <body>
        <h1>MTA Test</h1>
        <p>testing...</p>
    </body>
</html>